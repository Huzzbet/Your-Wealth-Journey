<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Wealth Projection Playground</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg: #030616;
      --bg-elevated: #0c1022;
      --bg-elevated-soft: #11162a;
      --border-subtle: rgba(255, 255, 255, 0.04);
      --accent: #2dd4ff;
      --accent-soft: rgba(45, 212, 255, 0.16);
      --accent-strong: #22c55e;
      --text: #f9fafb;
      --text-soft: #9ca3af;
      --danger: #f97373;
      --warning: #fbbf24;
      --card-radius: 18px;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.55);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top, #0f172a 0, #020617 42%, #000000 100%);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
    }

    .app-shell {
      min-height: 100vh;
      padding: 20px 16px 40px;
      max-width: 1100px;
      margin: 0 auto;
    }

    @media (min-width: 768px) {
      .app-shell {
        padding: 28px 24px 48px;
      }
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
      gap: 12px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .brand-icon {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: radial-gradient(circle at 30% 0%, #38bdf8 0, #0ea5e9 40%, #22c55e 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
      color: #e5f5ff;
      box-shadow: 0 10px 25px rgba(15, 118, 110, 0.55);
    }

    .brand-text h1 {
      font-size: 20px;
      margin: 0;
      letter-spacing: 0.03em;
    }

    .brand-text p {
      margin: 2px 0 0;
      font-size: 12px;
      color: var(--text-soft);
    }

    .advisor-toggle {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.85);
      cursor: pointer;
      font-size: 11px;
      color: var(--text-soft);
      user-select: none;
    }

    .advisor-toggle span.dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.55);
      box-shadow: 0 0 0 2px rgba(148, 163, 184, 0.25);
      transition: background 0.18s ease;
    }

    .advisor-toggle.active {
      border-color: rgba(45, 212, 191, 0.7);
      color: #a5f3fc;
      background: linear-gradient(to right, rgba(8, 47, 73, 0.9), rgba(6, 95, 70, 0.9));
    }

    .advisor-toggle.active span.dot {
      background: #22c55e;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.45);
    }

    .pill-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 118, 110, 0.17);
      color: #a5f3fc;
      font-size: 11px;
      margin: 6px 0 14px;
    }

    .pill-status .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.4);
    }

    .layout {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    @media (min-width: 960px) {
      .layout {
        display: grid;
        grid-template-columns: minmax(0, 360px) minmax(0, 1fr);
        gap: 20px;
        align-items: flex-start;
      }
    }

    .card {
      background: radial-gradient(circle at top left, #1e293b 0, #020617 50%);
      border-radius: var(--card-radius);
      border: 1px solid var(--border-subtle);
      padding: 16px 14px 14px;
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at top, rgba(59, 130, 246, 0.18), transparent 60%);
      opacity: 0.4;
      pointer-events: none;
      z-index: -1;
    }

    .card h2 {
      margin: 0 0 12px;
      font-size: 14px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #e5e7eb;
    }

    .card p.subtitle {
      margin: -6px 0 12px;
      font-size: 12px;
      color: var(--text-soft);
    }

    .input-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 10px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field label {
      font-size: 11px;
      color: var(--text-soft);
    }

    .field input,
    .field select {
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.85);
      color: var(--text);
      padding: 7px 9px;
      font-size: 13px;
      outline: none;
      width: 100%;
    }

    .field input:focus,
    .field select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.4);
    }

    .field input::placeholder {
      color: rgba(148, 163, 184, 0.7);
    }

    .field-suffix {
      font-size: 11px;
      color: rgba(148, 163, 184, 0.75);
    }

    .chips-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }

    .chip-toggle {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 5px 9px;
      font-size: 11px;
      color: var(--text-soft);
      background: rgba(15, 23, 42, 0.85);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .chip-toggle.active {
      background: rgba(45, 212, 255, 0.18);
      border-color: var(--accent);
      color: #e0f2fe;
    }

    .chip-toggle .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.6);
    }

    .chip-toggle.active .pill-dot {
      background: var(--accent);
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin: 6px 0 10px;
      flex-wrap: wrap;
    }

    .checkbox-inline {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .checkbox-inline input {
      accent-color: var(--accent);
      width: 13px;
      height: 13px;
    }

    .btn-primary {
      margin-top: 5px;
      width: 100%;
      border-radius: 999px;
      padding: 9px 14px;
      border: none;
      outline: none;
      background: linear-gradient(to right, #22c55e, #0ea5e9);
      color: #ecfeff;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 18px 35px rgba(22, 163, 74, 0.45);
    }

    .btn-primary span.spinner {
      display: none;
      width: 13px;
      height: 13px;
      border-radius: 999px;
      border: 2px solid rgba(15, 23, 42, 0.2);
      border-top-color: #0f172a;
      animation: spin 0.9s linear infinite;
    }

    .btn-primary.loading span.spinner {
      display: inline-block;
    }

    .btn-primary.loading .label {
      opacity: 0.7;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .tip {
      margin-top: 8px;
      font-size: 11px;
      color: var(--text-soft);
      line-height: 1.4;
    }

    /* Right column */

    .projection-card header {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: 8px;
    }

    .projection-card header h2 {
      margin-bottom: 4px;
    }

    .scenario-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 2px;
    }

    .scenario-chip {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 4px 9px;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.85);
      color: var(--text-soft);
      cursor: pointer;
    }

    .scenario-chip.active {
      background: rgba(45, 212, 255, 0.18);
      border-color: var(--accent);
      color: #e0f2fe;
    }

    .projection-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin: 8px 0;
    }

    .toggle-group {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
    }

    .toggle-pill {
      position: relative;
      width: 36px;
      height: 18px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.5);
      cursor: pointer;
    }

    .toggle-pill .thumb {
      position: absolute;
      top: 1px;
      left: 1px;
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: #64748b;
      transition: transform 0.2s ease, background 0.2s ease;
    }

    .toggle-pill.on {
      border-color: var(--accent);
      background: rgba(56, 189, 248, 0.25);
    }

    .toggle-pill.on .thumb {
      transform: translateX(16px);
      background: #22c55e;
    }

    .legend-dots {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }

    .legend-dot-base,
    .legend-dot-extra {
      width: 9px;
      height: 9px;
      border-radius: 999px;
    }

    .legend-dot-base {
      background: #38bdf8;
    }

    .legend-dot-extra {
      border: 2px dashed #22c55e;
    }

    .chart-wrap {
      position: relative;
      height: 260px;
      margin: 8px -4px 0;
    }

    @media (min-width: 960px) {
      .chart-wrap {
        height: 280px;
      }
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-top: 12px;
    }

    .metric-card {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 12px;
      padding: 8px 9px;
      border: 1px solid rgba(15, 118, 110, 0.35);
    }

    .metric-label {
      font-size: 11px;
      color: var(--text-soft);
      margin-bottom: 3px;
    }

    .metric-value {
      font-size: 15px;
      font-weight: 600;
    }

    .metric-footnote {
      font-size: 10px;
      color: rgba(148, 163, 184, 0.85);
      margin-top: 2px;
    }

    .metric-chip {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      margin-top: 5px;
      padding: 3px 7px;
      border-radius: 999px;
      font-size: 10px;
      background: rgba(34, 197, 94, 0.16);
      color: #bbf7d0;
    }

    .metric-chip.danger {
      background: rgba(248, 113, 113, 0.18);
      color: #fecaca;
    }

    .metric-chip.neutral {
      background: rgba(148, 163, 184, 0.25);
      color: #e5e7eb;
    }

    .score-large {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    .score-caption {
      font-size: 11px;
      color: rgba(190, 242, 100, 0.95);
      margin-top: 2px;
    }

    .score-caption.soft {
      color: rgba(248, 250, 252, 0.75);
    }

    .meter-wrap {
      margin-top: 6px;
    }

    .meter-bar-bg {
      width: 100%;
      height: 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.85);
      border: 1px solid rgba(148, 163, 184, 0.5);
      overflow: hidden;
    }

    .meter-bar-fill {
      height: 100%;
      width: 40%;
      border-radius: 999px;
      background: linear-gradient(to right, #22c55e, #a3e635);
      transition: width 0.35s ease-out;
    }

    .meter-label {
      font-size: 11px;
      margin-top: 3px;
      color: var(--text-soft);
    }

    /* FIRE + Behavioural cards */

    .stacked-grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 10px;
      margin-top: 12px;
    }

    @media (min-width: 960px) {
      .stacked-grid {
        grid-template-columns: minmax(0, 1.05fr) minmax(0, 0.95fr);
      }
    }

    .card-compact {
      background: rgba(15, 23, 42, 0.92);
      border-radius: 14px;
      padding: 10px 10px 9px;
      border: 1px solid rgba(51, 65, 85, 0.9);
    }

    .card-compact h3 {
      margin: 0 0 4px;
      font-size: 12px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #cbd5f5;
    }

    .card-compact p.small {
      margin: 0 0 6px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .fire-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 6px;
    }

    .fire-item-label {
      font-size: 11px;
      color: var(--text-soft);
    }

    .fire-item-value {
      font-size: 14px;
      font-weight: 600;
      margin-top: 1px;
    }

    .fire-tag {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 3px 7px;
      border-radius: 999px;
      font-size: 10px;
      margin-top: 4px;
    }

    .fire-tag.good {
      background: rgba(34, 197, 94, 0.16);
      color: #bbf7d0;
    }

    .fire-tag.ok {
      background: rgba(234, 179, 8, 0.18);
      color: #fef9c3;
    }

    .fire-tag.bad {
      background: rgba(248, 113, 113, 0.2);
      color: #fee2e2;
    }

    .insights-list {
      margin: 0;
      padding-left: 16px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .insights-list li + li {
      margin-top: 4px;
    }

    .badge-soft {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      font-size: 10px;
      margin-bottom: 4px;
      color: rgba(226, 232, 240, 0.9);
    }

    .badge-soft span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }

    .advisor-section {
      margin-top: 10px;
      font-size: 11px;
      color: rgba(148, 163, 184, 0.9);
      display: none;
    }

    .advisor-section.visible {
      display: block;
    }

    .advisor-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-top: 6px;
    }

    .advisor-pill {
      background: rgba(15, 23, 42, 0.95);
      padding: 6px 7px;
      border-radius: 10px;
      border: 1px dashed rgba(148, 163, 184, 0.55);
    }

    .advisor-pill span.label {
      display: block;
      font-size: 10px;
      color: rgba(148, 163, 184, 0.9);
    }

    .advisor-pill span.val {
      display: block;
      margin-top: 2px;
      font-size: 13px;
      font-weight: 600;
    }

    footer {
      margin-top: 18px;
      text-align: center;
      font-size: 10px;
      color: rgba(148, 163, 184, 0.7);
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="brand">
        <div class="brand-icon">WP</div>
        <div class="brand-text">
          <h1>Wealth Projection Playground</h1>
          <p>Adjust the levers and see how your decisions compound over time.</p>
          <div class="pill-status">
            <span class="dot"></span>
            <span>Live what-if engine</span>
          </div>
        </div>
      </div>

      <div class="advisor-toggle" id="advisorToggle">
        <span class="dot"></span>
        <span>Advisor mode</span>
      </div>
    </header>

    <div class="layout">
      <!-- LEFT: INPUTS -->
      <section class="card">
        <h2>Inputs</h2>
        <p class="subtitle">Tell the engine who you are and how you invest.</p>

        <div class="input-grid">
          <div class="field">
            <label for="currentAge">Current age</label>
            <input type="number" id="currentAge" value="40" min="18" max="75" />
          </div>

          <div class="field">
            <label for="retirementAge">Retirement age</label>
            <input type="number" id="retirementAge" value="67" min="40" max="80" />
          </div>

          <div class="field">
            <label for="currentBalance">Current balance</label>
            <input type="number" id="currentBalance" value="250000" step="1000" />
            <span class="field-suffix">In today’s dollars.</span>
          </div>

          <div class="field">
            <label for="regularContribution">Regular contribution</label>
            <input type="number" id="regularContribution" value="30000" step="500" />
            <span class="field-suffix">Total per contribution period.</span>
          </div>

          <div class="field">
            <label for="contributionFrequency">Contribution frequency</label>
            <select id="contributionFrequency">
              <option value="annual" selected>Annual</option>
              <option value="monthly">Monthly</option>
              <option value="fortnightly">Fortnightly</option>
            </select>
          </div>

          <div class="field">
            <label for="expectedReturn">Expected return (p.a.)</label>
            <input type="number" id="expectedReturn" value="7" step="0.1" />
            <span class="field-suffix">Before inflation.</span>
          </div>

          <div class="field">
            <label for="inflation">Inflation (for today’s dollars)</label>
            <input type="number" id="inflation" value="2.5" step="0.1" />
          </div>

          <div class="field">
            <label for="extraSaving">Scenario extra saving</label>
            <input type="number" id="extraSaving" value="5000" step="100" />
            <span class="field-suffix">Per month, applied to comparison line.</span>
          </div>

          <div class="field">
            <label for="targetIncome">Target retirement income</label>
            <input type="number" id="targetIncome" value="100000" step="5000" />
            <span class="field-suffix">Per year, in today’s dollars.</span>
          </div>

          <div class="field">
            <label for="currentIncome">Current gross income (optional)</label>
            <input type="number" id="currentIncome" placeholder="e.g. 160000" />
            <span class="field-suffix">Used to estimate savings rate.</span>
          </div>
        </div>

        <div class="chips-row">
          <button class="chip-toggle active" id="showRealToggle">
            <span class="pill-dot"></span> Show values in today’s dollars
          </button>
          <button class="chip-toggle active" id="compareExtraToggle">
            <span class="pill-dot"></span> Compare with extra saving scenario
          </button>
        </div>

        <div class="checkbox-row">
          <label class="checkbox-inline">
            <input type="checkbox" id="apply4Rule" checked />
            <span>Estimate retirement income using a 4% rule.</span>
          </label>
        </div>

        <button class="btn-primary" id="updateBtn">
          <span class="spinner"></span>
          <span class="label">Update projection</span>
        </button>

        <p class="tip">
          Tip: Nudge your retirement age, target income and contributions. Small changes can have a surprisingly large impact by retirement.
        </p>
      </section>

      <!-- RIGHT: PROJECTION, METRICS, FIRE, INSIGHTS -->
      <section class="card projection-card">
        <header>
          <h2>Projection</h2>
          <p class="subtitle">Your projected wealth path from today to retirement.</p>
        </header>

        <div class="scenario-row">
          <button class="scenario-chip active" data-scenario="base">Base</button>
          <button class="scenario-chip" data-scenario="bull">Bull (+2% return)</button>
          <button class="scenario-chip" data-scenario="bear">Bear (-2% return)</button>
          <button class="scenario-chip" data-scenario="inflation">High inflation (+2%)</button>
          <button class="scenario-chip" data-scenario="boost">Boost saving (+$200/m)</button>
          <button class="scenario-chip" data-scenario="shock">Stress: recession hit</button>
          <button class="scenario-chip" data-scenario="flat">Stress: flat decade</button>
        </div>

        <div class="projection-meta">
          <div class="toggle-group">
            <div class="toggle-pill on" id="todayToggle">
              <div class="thumb"></div>
            </div>
            <span>Show in today’s dollars</span>
          </div>
          <div class="legend-dots">
            <div class="legend-item">
              <span class="legend-dot-base"></span> <span>Base plan</span>
            </div>
            <div class="legend-item" id="legendExtra">
              <span class="legend-dot-extra"></span> <span>+ extra saving</span>
            </div>
          </div>
        </div>

        <div class="chart-wrap">
          <canvas id="projectionChart"></canvas>
        </div>

        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-label">Projected balance at retirement</div>
            <div class="metric-value" id="projBalance">$0</div>
            <div class="metric-footnote" id="projBalanceNote">Solid mix of contributions and growth.</div>
          </div>

          <div class="metric-card">
            <div class="metric-label">Total contributions</div>
            <div class="metric-value" id="totalContrib">$0</div>
            <div class="metric-footnote">Includes base plan only.</div>
          </div>

          <div class="metric-card">
            <div class="metric-label">Estimated income (4% rule)</div>
            <div class="metric-value" id="incomeEstimate">$0 / yr</div>
            <div class="metric-footnote">Illustrative only. Not personal advice.</div>
            <div class="metric-chip neutral" id="incomeChip">
              <span>Awaiting inputs…</span>
            </div>
          </div>

          <div class="metric-card">
            <div class="metric-label">Wealth health score</div>
            <div class="score-large" id="healthScore">– / 100</div>
            <div class="score-caption" id="healthCaption">We’ll score your plan once you run the engine.</div>
            <div class="meter-wrap">
              <div class="meter-bar-bg">
                <div class="meter-bar-fill" id="healthMeter"></div>
              </div>
              <div class="meter-label" id="meterLabel">Balanced plan: both savings and growth are doing work.</div>
            </div>
          </div>
        </div>

        <div class="stacked-grid">
          <!-- FIRE CARD -->
          <div class="card-compact">
            <h3>FIRE Radar</h3>
            <p class="small">A quick sense-check of how close you are to Financial Independence.</p>

            <div class="fire-grid">
              <div>
                <div class="fire-item-label">Coast FIRE age (approx.)</div>
                <div class="fire-item-value" id="coastAge">–</div>
              </div>
              <div>
                <div class="fire-item-label">Income vs target</div>
                <div class="fire-item-value" id="targetCoverage">–</div>
              </div>
            </div>

            <div class="fire-tag ok" id="fireTag">
              <span>We’ll run the radar once you update your projection.</span>
            </div>

            <div class="advisor-section" id="advisorSection">
              <div class="badge-soft">
                <span class="dot"></span> Advisor view
              </div>
              <div class="advisor-grid">
                <div class="advisor-pill">
                  <span class="label">Real return (after inflation)</span>
                  <span class="val" id="realReturnLabel">–</span>
                </div>
                <div class="advisor-pill">
                  <span class="label">Growth vs. contributions</span>
                  <span class="val" id="growthSplitLabel">–</span>
                </div>
              </div>
            </div>
          </div>

          <!-- INSIGHTS CARD -->
          <div class="card-compact">
            <h3>Behavioural Insights</h3>
            <p class="small">Tiny tweaks compound massively. Here’s what your current inputs are whispering.</p>

            <ul class="insights-list" id="insightsList">
              <li>Run a projection to generate tailored behavioural nudges.</li>
              <li>Try adjusting retirement age or extra savings to see how the narrative changes.</li>
            </ul>

            <div class="card-compact" style="margin-top:7px;background:rgba(15,23,42,0.96);border-style:dashed;">
              <p class="small" style="margin-bottom:4px;">
                Savings power meter
              </p>
              <div class="meter-bar-bg">
                <div class="meter-bar-fill" id="savingsMeter" style="width:35%;"></div>
              </div>
              <div class="meter-label" id="savingsLabel">We’ll estimate your savings rate once we know your income.</div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <footer>
      Illustrative modelling only. This playground is for education and exploration – it doesn’t replace personalised financial advice.
    </footer>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <script>
    // Utility helpers
    function formatCurrency(value) {
      if (!isFinite(value)) return "$0";
      const abs = Math.abs(value);
      const opts = {
        style: "currency",
        currency: "AUD",
        maximumFractionDigits: 0,
        minimumFractionDigits: 0
      };
      if (abs >= 1_000_000) {
        return (
          "A$" +
          (value / 1_000_000).toFixed(2).replace(/\.00$/, "") +
          "m"
        );
      }
      return new Intl.NumberFormat("en-AU", opts).format(value);
    }

    function clamp(num, min, max) {
      return Math.min(Math.max(num, min), max);
    }

    const scenarioButtons = document.querySelectorAll(".scenario-chip");
    const todayToggle = document.getElementById("todayToggle");
    const showRealChip = document.getElementById("showRealToggle");
    const compareExtraChip = document.getElementById("compareExtraToggle");
    const legendExtra = document.getElementById("legendExtra");
    const advisorToggle = document.getElementById("advisorToggle");
    const advisorSection = document.getElementById("advisorSection");
    const updateBtn = document.getElementById("updateBtn");

    let currentScenario = "base";
    let chart;

    todayToggle.addEventListener("click", () => {
      todayToggle.classList.toggle("on");
      showRealChip.classList.toggle("active");
      updateProjection();
    });

    showRealChip.addEventListener("click", () => {
      showRealChip.classList.toggle("active");
      todayToggle.classList.toggle("on");
      updateProjection();
    });

    compareExtraChip.addEventListener("click", () => {
      compareExtraChip.classList.toggle("active");
      legendExtra.style.opacity = compareExtraChip.classList.contains("active")
        ? "1"
        : "0.3";
      updateProjection();
    });

    advisorToggle.addEventListener("click", () => {
      advisorToggle.classList.toggle("active");
      advisorSection.classList.toggle("visible");
    });

    scenarioButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        scenarioButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        currentScenario = btn.dataset.scenario;
        updateProjection();
      });
    });

    updateBtn.addEventListener("click", () => {
      updateBtn.classList.add("loading");
      setTimeout(() => {
        updateProjection();
        updateBtn.classList.remove("loading");
      }, 120);
    });

    function getInputs() {
      const currentAge = parseFloat(document.getElementById("currentAge").value) || 40;
      const retirementAge = parseFloat(document.getElementById("retirementAge").value) || 67;
      const currentBalance = parseFloat(document.getElementById("currentBalance").value) || 0;
      const regularContribution = parseFloat(document.getElementById("regularContribution").value) || 0;
      const contributionFrequency = document.getElementById("contributionFrequency").value || "annual";
      const expectedReturn = parseFloat(document.getElementById("expectedReturn").value) || 7;
      const inflation = parseFloat(document.getElementById("inflation").value) || 2.5;
      const extraSavingMonthly = parseFloat(document.getElementById("extraSaving").value) || 0;
      const targetIncome = parseFloat(document.getElementById("targetIncome").value) || 0;
      const currentIncome = parseFloat(document.getElementById("currentIncome").value) || null;
      const apply4Rule = document.getElementById("apply4Rule").checked;
      const showReal = showRealChip.classList.contains("active");

      let annualContribution;
      if (contributionFrequency === "monthly") annualContribution = regularContribution * 12;
      else if (contributionFrequency === "fortnightly") annualContribution = regularContribution * 26;
      else annualContribution = regularContribution;

      return {
        currentAge,
        retirementAge,
        currentBalance,
        annualContribution,
        expectedReturn,
        inflation,
        extraSavingMonthly,
        targetIncome,
        currentIncome,
        apply4Rule,
        showReal
      };
    }

    function getScenarioAdjustments(baseReturn, baseInflation, extraSavingMonthly) {
      let adjReturn = 0;
      let adjInflation = 0;
      let extraMonthlyBoost = 0;
      let stressMode = "none";

      switch (currentScenario) {
        case "bull":
          adjReturn = 2;
          break;
        case "bear":
          adjReturn = -2;
          break;
        case "inflation":
          adjInflation = 2;
          break;
        case "boost":
          extraMonthlyBoost = 200;
          break;
        case "shock":
          stressMode = "shock";
          break;
        case "flat":
          stressMode = "flat";
          break;
        default:
          break;
      }

      return {
        effectiveReturn: baseReturn + adjReturn,
        effectiveInflation: baseInflation + adjInflation,
        totalExtraMonthly: extraSavingMonthly + extraMonthlyBoost,
        stressMode
      };
    }

    function buildProjection() {
      const inputs = getInputs();
      const yrs = Math.max(1, Math.round(inputs.retirementAge - inputs.currentAge));
      const { effectiveReturn, effectiveInflation, totalExtraMonthly, stressMode } =
        getScenarioAdjustments(inputs.expectedReturn, inputs.inflation, inputs.extraSavingMonthly);

      const showExtra = compareExtraChip.classList.contains("active");

      const realRateBase =
        ((inputs.expectedReturn - inputs.inflation) / 100);
      const realRateScenario =
        ((effectiveReturn - effectiveInflation) / 100);

      const annualExtra = totalExtraMonthly * 12;

      const ages = [];
      const balancesBase = [];
      const balancesExtra = [];

      let balBase = inputs.currentBalance;
      let balExtra = inputs.currentBalance;
      let totalContributions = 0;
      let totalContributionsExtra = 0;

      const shockYearIndex = Math.max(2, Math.floor(yrs * 0.25)); // after a few years

      for (let i = 0; i <= yrs; i++) {
        const age = inputs.currentAge + i;
        ages.push(age);

        if (i > 0) {
          // BASE
          balBase = balBase * (1 + realRateBase) + inputs.annualContribution;
          totalContributions += inputs.annualContribution;

          // STRESS MODES on EXTRA path
          let effectiveRateExtra = realRateScenario;

          if (stressMode === "shock" && i === shockYearIndex) {
            // one-off drawdown of 20%
            balExtra *= 0.8;
          } else if (stressMode === "flat" && i <= 10) {
            effectiveRateExtra = 0; // flat for first decade
          }

          balExtra = balExtra * (1 + effectiveRateExtra) + inputs.annualContribution + annualExtra;
          totalContributionsExtra += inputs.annualContribution + annualExtra;
        }

        balancesBase.push(balBase);
        balancesExtra.push(balExtra);
      }

      let finalBase = balancesBase[balancesBase.length - 1];
      let finalExtra = balancesExtra[balancesExtra.length - 1];

      if (inputs.showReal) {
        const inflationFactor = Math.pow(1 + inputs.inflation / 100, yrs);
        finalBase /= inflationFactor;
        finalExtra /= inflationFactor;
      }

      // Adjust arrays for real terms if needed
      if (inputs.showReal) {
        const adjustedBase = [];
        const adjustedExtra = [];
        for (let i = 0; i < balancesBase.length; i++) {
          const yearsOut = i;
          const factor = Math.pow(1 + inputs.inflation / 100, yearsOut);
          adjustedBase.push(balancesBase[i] / factor);
          adjustedExtra.push(balancesExtra[i] / factor);
        }
        return {
          inputs,
          ages,
          balancesBase: adjustedBase,
          balancesExtra: adjustedExtra,
          finalBase: finalBase,
          finalExtra: finalExtra,
          totalContributions,
          totalContributionsExtra,
          realRateBase,
          realRateScenario
        };
      }

      return {
        inputs,
        ages,
        balancesBase,
        balancesExtra,
        finalBase,
        finalExtra,
        totalContributions,
        totalContributionsExtra,
        realRateBase,
        realRateScenario
      };
    }

    function updateChart(ages, baseSeries, extraSeries, showExtra) {
      const ctx = document.getElementById("projectionChart").getContext("2d");

      const data = {
        labels: ages,
        datasets: [
          {
            label: "Base plan",
            data: baseSeries,
            borderColor: "#38bdf8",
            backgroundColor: "rgba(56,189,248,0.12)",
            tension: 0.25,
            borderWidth: 2.4,
            fill: true
          }
        ]
      };

      if (showExtra) {
        data.datasets.push({
          label: "Extra saving scenario",
          data: extraSeries,
          borderColor: "#22c55e",
          borderDash: [6, 4],
          borderWidth: 2.2,
          pointRadius: 0,
          fill: false
        });
      }

      const config = {
        type: "line",
        data,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: "index",
            intersect: false
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                title(context) {
                  const age = context[0].label;
                  return "Age " + age;
                },
                label(context) {
                  const label = context.dataset.label || "";
                  const val = formatCurrency(context.parsed.y);
                  return label + ": " + val;
                }
              }
            }
          },
          scales: {
            x: {
              grid: {
                color: "rgba(148,163,184,0.18)"
              },
              ticks: {
                color: "rgba(148,163,184,0.8)",
                maxRotation: 0
              }
            },
            y: {
              grid: {
                color: "rgba(30,64,175,0.26)"
              },
              ticks: {
                color: "rgba(148,163,184,0.8)",
                callback(value) {
                  if (value >= 1_000_000) return value / 1_000_000 + "m";
                  if (value >= 1000) return value / 1000 + "k";
                  return value;
                }
              }
            }
          }
        }
      };

      if (chart) {
        chart.destroy();
      }
      chart = new Chart(ctx, config);
    }

    function updateMetrics(result) {
      const {
        inputs,
        ages,
        finalBase,
        finalExtra,
        totalContributions,
        realRateBase,
        realRateScenario
      } = result;

      // Projected balance + note
      const projBalanceEl = document.getElementById("projBalance");
      const projBalanceNoteEl = document.getElementById("projBalanceNote");
      projBalanceEl.textContent = formatCurrency(finalBase);

      const growthMultiple =
        finalBase > 0 && totalContributions > 0
          ? finalBase / totalContributions
          : 1;

      if (growthMultiple >= 3) {
        projBalanceNoteEl.textContent =
          "Compounding is doing the heavy lifting. Protect your time in the market.";
      } else if (growthMultiple >= 2) {
        projBalanceNoteEl.textContent =
          "Solid mix of contributions and growth. Staying consistent matters.";
      } else {
        projBalanceNoteEl.textContent =
          "Most of this balance is coming from contributions – consider nudging return or time horizon.";
      }

      document.getElementById("totalContrib").textContent =
        formatCurrency(totalContributions);

      // Estimated income via 4% rule
      const incomeEstimateEl = document.getElementById("incomeEstimate");
      const incomeChip = document.getElementById("incomeChip");
      const targetCoverageEl = document.getElementById("targetCoverage");
      const fireTag = document.getElementById("fireTag");

      let estIncome = 0;
      if (inputs.apply4Rule) {
        estIncome = finalBase * 0.04;
      }
      incomeEstimateEl.textContent = formatCurrency(estIncome) + " / yr";

      // Coverage vs target income
      let coveragePct = 0;
      if (inputs.targetIncome > 0) {
        coveragePct = estIncome / inputs.targetIncome;
      }

      if (!isFinite(coveragePct) || coveragePct === 0) {
        targetCoverageEl.textContent = "–";
        incomeChip.className = "metric-chip neutral";
        incomeChip.textContent = "Add a target income to see coverage.";
      } else {
        const pctLabel = (coveragePct * 100).toFixed(0) + "% of target";
        targetCoverageEl.textContent = pctLabel;

        if (coveragePct >= 1.2) {
          incomeChip.className = "metric-chip";
          incomeChip.textContent = "Projected income comfortably exceeds target.";
        } else if (coveragePct >= 1) {
          incomeChip.className = "metric-chip";
          incomeChip.textContent = "On track – your projected income meets your target.";
        } else if (coveragePct >= 0.8) {
          incomeChip.className = "metric-chip neutral";
          incomeChip.textContent =
            "Slight shortfall – modest tweaks to contributions or retirement age could close this gap.";
        } else {
          incomeChip.className = "metric-chip danger";
          incomeChip.textContent =
            "Meaningful gap – consider higher savings, longer horizon, or lower spending target.";
        }
      }

      // Wealth health score
      const healthScoreEl = document.getElementById("healthScore");
      const healthCaptionEl = document.getElementById("healthCaption");
      const healthMeter = document.getElementById("healthMeter");
      const meterLabel = document.getElementById("meterLabel");

      let score = 60;

      // Score building blocks: coverage, contribution effort, time horizon
      const coverageComponent = clamp((coveragePct || 0) * 60, 0, 70);
      const yearsToRetire = Math.max(
        1,
        Math.round(inputs.retirementAge - inputs.currentAge)
      );
      const horizonComponent = clamp((yearsToRetire / 35) * 20, 4, 20);

      const contribEffort =
        totalContributions /
        (yearsToRetire * (inputs.currentBalance + 1));
      const contribComponent = clamp(contribEffort * 30, 0, 15);

      score = clamp(
        35 + coverageComponent + horizonComponent + contribComponent,
        15,
        99
      );

      healthScoreEl.textContent = Math.round(score) + " / 100";

      if (score >= 90) {
        healthCaptionEl.textContent =
          "Very strong projection. You’re giving compounding a lot of time and fuel to work with.";
        meterLabel.textContent =
          "Elite savings and growth combo – just keep your risk in check.";
      } else if (score >= 80) {
        healthCaptionEl.textContent =
          "On a strong path. Small tweaks could pull your retirement date forward.";
        meterLabel.textContent =
          "Balanced plan: both savings and growth are doing work.";
      } else if (score >= 65) {
        healthCaptionEl.textContent =
          "Reasonable, but there’s room for improvement in either savings rate or investment mix.";
        meterLabel.textContent =
          "Moderate savings power – pushing a bit harder now could really help future-you.";
      } else {
        healthCaptionEl.textContent =
          "You’ve started the journey. Increasing savings or adjusting expectations could help a lot.";
        meterLabel.textContent =
          "Low savings power relative to your target. Consider upping contributions if possible.";
      }

      healthMeter.style.width = clamp(score, 8, 100) + "%";

      // FIRE radar – approximate Coast FIRE age
      const coastAgeEl = document.getElementById("coastAge");

      let coastAgeDisplay = "Not reached";
      if (inputs.targetIncome > 0) {
        const needed = inputs.targetIncome / 0.04;
        // find first age where base balance (nominal or real as chosen) >= needed
        let coastAge = null;
        for (let i = 0; i < result.balancesBase.length; i++) {
          if (result.balancesBase[i] >= needed) {
            coastAge = ages[i];
            break;
          }
        }
        if (coastAge) coastAgeDisplay = coastAge.toFixed(0);
      }
      coastAgeEl.textContent = coastAgeDisplay;

      if (coveragePct >= 1.1 && coastAgeDisplay !== "Not reached") {
        fireTag.className = "fire-tag good";
        fireTag.textContent =
          "You’re tracking ahead of target – you may unlock flexibility well before retirement age.";
      } else if (coveragePct >= 0.85) {
        fireTag.className = "fire-tag ok";
        fireTag.textContent =
          "Close to your FIRE lane. A small boost to savings or returns could tip you over the line.";
      } else {
        fireTag.className = "fire-tag bad";
        fireTag.textContent =
          "FIRE is still some distance away. Use this as a dashboard to test higher savings or longer horizons.";
      }

      // Advisor mode stats
      const realReturnLabel = document.getElementById("realReturnLabel");
      const growthSplitLabel = document.getElementById("growthSplitLabel");

      realReturnLabel.textContent =
        (realRateScenario * 100).toFixed(2) + "% p.a. real";

      const growthPortion =
        finalBase > 0 ? (finalBase - totalContributions) / finalBase : 0;
      const growthPct = clamp(growthPortion * 100, 0, 100);
      growthSplitLabel.textContent =
        growthPct.toFixed(0) +
        "% growth / " +
        (100 - growthPct).toFixed(0) +
        "% contributions";

      // Behavioural insights
      updateInsights(result, coveragePct, growthPct);

      // Savings power meter
      updateSavingsMeter(inputs, totalContributions);
    }

    function updateInsights(result, coveragePct, growthPct) {
      const list = document.getElementById("insightsList");
      list.innerHTML = "";

      const { inputs, finalBase, finalExtra } = result;
      const yrs = Math.max(
        1,
        Math.round(inputs.retirementAge - inputs.currentAge)
      );

      const extraDiff = finalExtra - finalBase;
      const hasExtra = compareExtraChip.classList.contains("active");

      const li1 = document.createElement("li");
      if (hasExtra && extraDiff > 0) {
        li1.textContent =
          "Adding " +
          formatCurrency(inputs.extraSavingMonthly * 12) +
          "/yr in extra savings could add around " +
          formatCurrency(extraDiff) +
          " to your retirement balance over " +
          yrs +
          " years.";
      } else {
        li1.textContent =
          "Consistent contributions over " +
          yrs +
          " years are your main superpower – the market just amplifies it.";
      }
      list.appendChild(li1);

      const li2 = document.createElement("li");
      if (coveragePct >= 1.1) {
        li2.textContent =
          "Your projected income beats your target. You could either retire earlier, spend more, or build in a wider safety buffer.";
      } else if (coveragePct >= 0.9) {
        li2.textContent =
          "You’re close to fully funding your target lifestyle – nudging savings by 5–10% or delaying retirement a couple of years would likely close the gap.";
      } else {
        li2.textContent =
          "There’s a noticeable gap to your target income. Try increasing contributions, adjusting investment returns, or lowering the spending target and re-running.";
      }
      list.appendChild(li2);

      const li3 = document.createElement("li");
      if (growthPct >= 65) {
        li3.textContent =
          "Most of your end balance is projected to come from growth, not contributions. Staying invested through volatility will matter more than timing the market.";
      } else if (growthPct >= 45) {
        li3.textContent =
          "Contributions and growth are fairly balanced – both savings discipline and an appropriate risk profile matter here.";
      } else {
        li3.textContent =
          "Your projection is heavily contribution-driven. That’s fine early on, but you may want more growth assets if your risk tolerance allows.";
      }
      list.appendChild(li3);
    }

    function updateSavingsMeter(inputs, totalContributions) {
      const savingsMeter = document.getElementById("savingsMeter");
      const savingsLabel = document.getElementById("savingsLabel");

      if (!inputs.currentIncome || inputs.currentIncome <= 0) {
        savingsMeter.style.width = "35%";
        savingsLabel.textContent =
          "Enter your income to estimate your savings rate and savings power.";
        return;
      }

      const annualTotalSavings =
        inputs.annualContribution + inputs.extraSavingMonthly * 12;
      const savingsRate = clamp(
        (annualTotalSavings / inputs.currentIncome) * 100,
        0,
        80
      );

      savingsMeter.style.width = savingsRate + "%";

      if (savingsRate >= 40) {
        savingsLabel.textContent =
          "High-octane plan: you’re saving roughly " +
          savingsRate.toFixed(0) +
          "% of your income. Make sure it’s sustainable emotionally.";
      } else if (savingsRate >= 25) {
        savingsLabel.textContent =
          "Strong savings rhythm at about " +
          savingsRate.toFixed(0) +
          "% of income. This is classic FIRE-friendly territory.";
      } else if (savingsRate >= 15) {
        savingsLabel.textContent =
          "Solid savings rate around " +
          savingsRate.toFixed(0) +
          "% – nudging it a few points higher could move the needle.";
      } else {
        savingsLabel.textContent =
          "Savings rate near " +
          savingsRate.toFixed(0) +
          "% – even a small bump could compound into a very different retirement picture.";
      }
    }

    function updateProjection() {
      const result = buildProjection();
      updateChart(
        result.ages,
        result.balancesBase,
        result.balancesExtra,
        compareExtraChip.classList.contains("active")
      );
      updateMetrics(result);
    }

    // Initial run
    updateProjection();
  </script>
</body>
</html>
